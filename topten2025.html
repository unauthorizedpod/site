<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025 Film Ranker | Some Like It Unauthorized</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%230D0B14'/%3E%3Ctext x='16' y='13' font-family='Manrope, sans-serif' font-size='12' font-weight='bold' fill='%23a78bfa' text-anchor='middle'%3ESL%3C/text%3E%3Ctext x='16' y='27' font-family='Manrope, sans-serif' font-size='12' font-weight='bold' fill='%23a78bfa' text-anchor='middle'%3EIU%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Manrope:wght@600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0D0B14;
            color: #D1D5DB;
            overflow-x: hidden;
        }
        h1, h2, h3 {
            font-family: 'Manrope', sans-serif;
            color: #F9FAFB;
        }
        .gradient-text {
            background: linear-gradient(to right, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .slot {
            aspect-ratio: 16/9;
            background-color: #1A1625;
            border: 2px dashed #2a2438;
            border-radius: 0.75rem;
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .slot.drag-over {
            border-color: #a78bfa;
            background-color: rgba(167, 139, 250, 0.1);
        }
        .slot-number {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 24px;
            height: 24px;
            background: #a78bfa;
            color: #0D0B14;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.65rem;
            z-index: 20;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .film-item {
            width: 100%;
            height: 100%;
            cursor: grab;
            position: relative;
            border-radius: 0.6rem;
            overflow: hidden;
            transition: transform 0.2s;
            z-index: 10;
        }
        .film-item:active { cursor: grabbing; }
        .film-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .film-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 0.4rem;
            background: linear-gradient(to top, rgba(13, 11, 20, 0.95), transparent);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            text-align: center;
            pointer-events: none;
            text-transform: uppercase;
        }

        .pool-container {
            background-color: #1A1625;
            border: 1px solid #2a2438;
            border-radius: 1rem;
            padding: 1rem;
            position: relative;
        }
        
        .pool-grid {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            overflow-y: hidden;
            gap: 1rem;
            padding: 0.5rem;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .pool-item {
            flex: 0 0 160px; /* Fixed width for horizontal scrolling */
            aspect-ratio: 16/9;
            background: #2a2438;
            border-radius: 0.5rem;
            cursor: grab;
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .pool-item:hover {
            border-color: #a78bfa;
            transform: translateY(-4px);
            z-index: 30;
        }

        .consensus-card {
            background: linear-gradient(145deg, #1A1625, #0D0B14);
            border: 1px solid #2a2438;
            border-radius: 1rem;
            padding: 1.5rem;
        }

        /* Custom Scrollbar for horizontal scroller */
        .pool-grid::-webkit-scrollbar { height: 8px; }
        .pool-grid::-webkit-scrollbar-track { background: #0D0B14; border-radius: 10px; }
        .pool-grid::-webkit-scrollbar-thumb { background: #2a2438; border-radius: 10px; border: 2px solid #0D0B14; }
        .pool-grid::-webkit-scrollbar-thumb:hover { background: #a78bfa; }

        /* General vertical scroller */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #2a2438; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #4a4063; }
    </style>
</head>
<body class="antialiased min-h-screen p-4 md:p-8">

    <main class="max-w-7xl mx-auto space-y-12">
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 pt-8">
            <!-- J Brooks Section -->
            <section id="jbrooks-grid">
                <h2 class="text-xl font-bold mb-6 text-purple-400 uppercase tracking-widest flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-xs">JB</span>
                    J Brooks' Top Ten
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-5 gap-4">
                    <div class="slot" data-user="jbrooks" data-rank="1"><div class="slot-number">1</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="2"><div class="slot-number">2</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="3"><div class="slot-number">3</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="4"><div class="slot-number">4</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="5"><div class="slot-number">5</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="6"><div class="slot-number">6</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="7"><div class="slot-number">7</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="8"><div class="slot-number">8</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="9"><div class="slot-number">9</div></div>
                    <div class="slot" data-user="jbrooks" data-rank="10"><div class="slot-number">10</div></div>
                </div>
            </section>

            <!-- Zach Section (Updated Color) -->
            <section id="zach-grid">
                <h2 class="text-xl font-bold mb-6 text-purple-400 uppercase tracking-widest flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full bg-purple-500/20 flex items-center justify-center text-xs">ZD</span>
                    Zach's Top Ten
                </h2>
                <div class="grid grid-cols-2 sm:grid-cols-5 gap-4">
                    <div class="slot" data-user="zach" data-rank="1"><div class="slot-number">1</div></div>
                    <div class="slot" data-user="zach" data-rank="2"><div class="slot-number">2</div></div>
                    <div class="slot" data-user="zach" data-rank="3"><div class="slot-number">3</div></div>
                    <div class="slot" data-user="zach" data-rank="4"><div class="slot-number">4</div></div>
                    <div class="slot" data-user="zach" data-rank="5"><div class="slot-number">5</div></div>
                    <div class="slot" data-user="zach" data-rank="6"><div class="slot-number">6</div></div>
                    <div class="slot" data-user="zach" data-rank="7"><div class="slot-number">7</div></div>
                    <div class="slot" data-user="zach" data-rank="8"><div class="slot-number">8</div></div>
                    <div class="slot" data-user="zach" data-rank="9"><div class="slot-number">9</div></div>
                    <div class="slot" data-user="zach" data-rank="10"><div class="slot-number">10</div></div>
                </div>
            </section>
        </div>

        <!-- Pool of Films (Horizontal Scroller) -->
        <section>
            <div class="flex justify-between items-end mb-4">
                <h2 class="text-xl font-bold text-gray-400 uppercase tracking-widest">Film Pool</h2>
                <button id="reset-btn" class="text-xs text-gray-500 hover:text-white transition-colors underline">Clear All Slots</button>
            </div>
            <div class="pool-container">
                <div id="pool" class="pool-grid">
                    <div class="col-span-full py-10 px-8 text-center text-gray-600 animate-pulse">Loading backdrops...</div>
                </div>
            </div>
        </section>

        <!-- Consensus Section -->
        <section id="consensus-section">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-center gradient-text uppercase tracking-[0.2em]">The Consensus</h2>
                <div class="consensus-card">
                    <div id="consensus-list" class="space-y-4">
                        <p class="text-center text-gray-500 italic py-4">Build both lists to see the shared top ten...</p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <script>
        const apiKey = "746e663319009236f390938e29383ae0";
        const poolEl = document.getElementById('pool');
        const slots = document.querySelectorAll('.slot');
        const consensusListEl = document.getElementById('consensus-list');
        const resetBtn = document.getElementById('reset-btn');

        const filmTitles = [
            "Marty Supreme", "One Battle After Another", "No Other Choice", "Bugonia", "Dracula Radu Jude", 
            "Weapons", "28 Years Later", "Materialists", "Mastermind", "Sentimental Value",
            "It Was Just an Accident", "Phoenician Scheme", "Nouvelle Vague", "Eddington", "Sinners", 
            "What Does the Nature Say to You", "Kontinental 25", "Blue Moon", "Mickey 17", "Magic Farm",
            "Peter Hujars Day", "Sorry, Baby", "Train Dreams", "If I Had Legs Iâ€™d Kick You", 
            "Caught By the Tides", "On Becoming a Guinea Fowl", "Secret Agent", "Roofman", 
            "Jay Kelly", "Springsteen", "Dreams (Sex Love Dreams)", "Friendship"
        ];

        let draggedElement = null;
        let isFromPool = false;

        async function init() {
            poolEl.innerHTML = '';
            const films = await Promise.all(filmTitles.map(async (title) => {
                const backdrop = await fetchBackdrop(title);
                return { title, backdrop };
            }));
            films.forEach(film => poolEl.appendChild(createFilmElement(film, true)));
            setupDragAndDrop();
        }

        async function fetchBackdrop(title) {
            try {
                let query = title;
                if (title.includes("Dreams (Sex Love Dreams)")) {
                    query = "Sex, Love, Dreams";
                } else if (title.includes("Dracula")) {
                    query = "Dracula Radu Jude";
                }

                let response = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&year=2025`);
                let data = await response.json();
                
                if (!data.results?.length) {
                    response = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}`);
                    data = await response.json();
                }
                
                if (data.results?.length > 0) {
                    const match = data.results[0];
                    return match.backdrop_path ? `https://image.tmdb.org/t/p/w780${match.backdrop_path}` : (match.poster_path ? `https://image.tmdb.org/t/p/w500${match.poster_path}` : null);
                }
                return null;
            } catch { return null; }
        }

        function createFilmElement(film, inPool = false) {
            const div = document.createElement('div');
            div.className = 'film-item shadow-lg';
            if (inPool) div.className += ' pool-item';
            div.draggable = true;
            
            let displayTitle = film.title
                .replace(" Radu Jude", "")
                .replace(" (Sex Love Dreams)", "");
                
            div.dataset.title = displayTitle;
            div.dataset.backdrop = film.backdrop || "";
            
            if (film.backdrop) {
                div.innerHTML = `<img src="${film.backdrop}" alt="${displayTitle}" loading="lazy"><div class="film-overlay">${displayTitle}</div>`;
            } else {
                div.innerHTML = `<div class="w-full h-full flex items-center justify-center p-2 text-center text-[10px] bg-gray-900 text-gray-500 border border-gray-800">${displayTitle}</div><div class="film-overlay">${displayTitle}</div>`;
            }
            return div;
        }

        function calculateConsensus() {
            const jRankings = {};
            const zRankings = {};
            const allFilmsSet = new Set();

            document.querySelectorAll('.slot').forEach(slot => {
                const filmItem = slot.querySelector('.film-item');
                if (filmItem) {
                    const title = filmItem.dataset.title;
                    const rank = parseInt(slot.dataset.rank);
                    if (slot.dataset.user === 'jbrooks') jRankings[title] = rank;
                    else zRankings[title] = rank;
                    allFilmsSet.add(title);
                }
            });

            if (allFilmsSet.size === 0) {
                consensusListEl.innerHTML = '<p class="text-center text-gray-500 italic py-4">Build both lists to see the shared top ten...</p>';
                return;
            }

            const consensus = Array.from(allFilmsSet).map(title => {
                const r1 = jRankings[title] || 15;
                const r2 = zRankings[title] || 15;
                return { title, score: (r1 + r2) / 2 };
            });

            consensus.sort((a, b) => a.score - b.score);

            consensusListEl.innerHTML = consensus.slice(0, 10).map((item, index) => `
                <div class="flex items-center justify-between p-3 bg-[#2a2438]/30 rounded-lg border border-[#2a2438]">
                    <div class="flex items-center gap-4">
                        <span class="text-purple-400 font-bold w-6">#${index + 1}</span>
                        <span class="text-white font-semibold">${item.title}</span>
                    </div>
                    <div class="flex gap-4 items-center">
                        <span class="text-[10px] text-gray-500 uppercase tracking-tighter">Score: ${item.score.toFixed(1)}</span>
                    </div>
                </div>
            `).join('');
        }

        function setupDragAndDrop() {
            document.addEventListener('dragstart', (e) => {
                const target = e.target.closest('.film-item');
                if (target) {
                    draggedElement = target;
                    isFromPool = target.closest('#pool') !== null;
                    target.style.opacity = '0.4';
                }
            });

            document.addEventListener('dragend', () => {
                if (draggedElement) draggedElement.style.opacity = '1';
                calculateConsensus();
            });

            slots.forEach(slot => {
                slot.addEventListener('dragover', (e) => { e.preventDefault(); slot.classList.add('drag-over'); });
                slot.addEventListener('dragleave', () => slot.classList.remove('drag-over'));
                slot.addEventListener('drop', (e) => {
                    e.preventDefault();
                    slot.classList.remove('drag-over');
                    if (!draggedElement) return;

                    if (isFromPool) {
                        const existingInSlot = slot.querySelector('.film-item');
                        if (existingInSlot) existingInSlot.remove();
                        
                        const clone = createFilmElement({
                            title: draggedElement.dataset.title,
                            backdrop: draggedElement.dataset.backdrop
                        }, false);
                        slot.appendChild(clone);
                    } else {
                        const existingInSlot = slot.querySelector('.film-item');
                        const sourceParent = draggedElement.parentNode;
                        
                        if (existingInSlot && sourceParent && sourceParent.classList.contains('slot')) {
                            sourceParent.appendChild(existingInSlot);
                            slot.appendChild(draggedElement);
                        } else {
                            if (existingInSlot) existingInSlot.remove();
                            slot.appendChild(draggedElement);
                        }
                    }
                    calculateConsensus();
                });
            });

            poolEl.addEventListener('dragover', (e) => e.preventDefault());
            poolEl.addEventListener('drop', (e) => {
                e.preventDefault();
                if (draggedElement && !isFromPool) {
                    draggedElement.remove();
                    calculateConsensus();
                }
            });
        }

        resetBtn.addEventListener('click', () => {
            document.querySelectorAll('.slot .film-item').forEach(film => film.remove());
            calculateConsensus();
        });

        init();
    </script>
</body>
</html>
